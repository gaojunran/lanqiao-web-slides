---
# You can also start simply with 'default'
theme: ../theme
# random image from a curated Unsplash collection by Anthony
# like them? see https://unsplash.com/collections/94734566/slidev
background: https://images.unsplash.com/photo-1621237023000-6a628c285938?q=80&w=3270&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D
# some information about your slides (markdown enabled)
title: å¼‚æ­¥ç¼–ç¨‹
info: |
  Created with [Sli.dev](https://sli.dev)
# apply unocss classes to the current slide
class: text-center
# https://sli.dev/features/drawing
drawings:
  persist: false
# slide transition: https://sli.dev/guide/animations.html#slide-transitions
transition: fade-out
# enable MDC Syntax: https://sli.dev/features/mdc
mdc: true
---

# å¼‚æ­¥ç¼–ç¨‹ { .!text-yellow-100}

è“æ¡¥æ¯Webç»„ çœèµ›å¤‡èµ› {.!text-white/50}

---

# å¼‚æ­¥ç¼–ç¨‹

<v-clicks class="text-2xl">

1. ä½¿ç”¨å›è°ƒçš„å¼‚æ­¥ç¼–ç¨‹

2. æœŸçº¦(`Promise`)

3. `async`/`await`

</v-clicks>

---



# ä½¿ç”¨å›è°ƒçš„å¼‚æ­¥ç¼–ç¨‹

å›è°ƒå°±æ˜¯å‡½æ•°ï¼Œå¯ä»¥ä¼ ç»™å…¶å®ƒå‡½æ•°ã€‚å…¶å®ƒå‡½æ•°ä¼šåœ¨æ»¡è¶³ä¸€å®šæ¡ä»¶ï¼ˆæˆ–å‘ç”Ÿä¸€å®šäº‹ä»¶ï¼‰åï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚

<My></My>

<v-clicks>

## å®šæ—¶å™¨

`setTimeout`:
```js
const ding = () => console.log('dong');

setTimeout(ding, 1000);
```

`setInterval`:
````md magic-move

```js
const beep = () => console.log('beep');

setInterval(beep, 1000);
```

```js
const beep = () => console.log('beep');

let intervalId = setInterval(beep, 1000);
```

```js
let count = 0;
const beep = () => {
  count++;
  console.log('beep');
  if (count === 3) clearInterval(intervalId);
}

let intervalId = setInterval(beep, 1000);
```
````

</v-clicks>

---

# å®šæ—¶å™¨

æ³¨æ„ï¼š`setTimeout`ä¸æ˜¯çœŸæ­£çš„ç­‰å¾…æ—¶é—´ï¼Œè€Œæ˜¯åªæ˜¯ä¸€ä¸ªå‡ ç§’åæ‰§è¡Œä»»åŠ¡çš„**å›è°ƒé’©å­**ã€‚

<Tag name="ç¯çš„é¢œè‰²å˜åŒ–" :difficulty="2" :year="2022" :id="2451" />

---

# äº‹ä»¶

å®¢æˆ·ç«¯JavaScriptå‡ ä¹å…¨éƒ½æ˜¯äº‹ä»¶é©±åŠ¨çš„ã€‚ç­‰å¾…ç”¨æˆ·åšä¸€äº›äº‹ï¼Œç„¶åå“åº”ç”¨æˆ·çš„åŠ¨ä½œã€‚

<v-clicks>

äº‹ä»¶ç›‘å¬å™¨æ˜¯é€šè¿‡`addEventListener`æ¥æ·»åŠ çš„ã€‚

```js{hide|1|all}
let okey = document.querySelector('#okey');

okey.addEventListener('click', () => {
  console.log('clicked');
});
```

**æ€è€ƒ**ï¼šå¦‚ä½•ç»‘å®šä¸€ä¸ªäº‹ä»¶ï¼Ÿ

````md magic-move
```vue

<button>Click me</button>

```

```html

<button onclick="handleClick()">Click me</button>  <!-- åŸç”ŸJavaScript -->

```


```vue

<button @click="handleClick">Click me</button> <!-- Vue -->

```
````

</v-clicks>

---

# `defineEmits`

https://vuejs.org/guide/components/events.html

<v-clicks>

**æ€è€ƒ**ï¼šVue3ä¸­å¦‚ä½•å£°æ˜ä¸€ä¸ªç»„ä»¶å°†å‘å‡ºçš„äº‹ä»¶ï¼Ÿ

````md magic-move
```vue
<!-- MyComponent -->
<button @click="handleClick">Click Me</button> <!-- äº‹ä»¶å°†åœ¨ç»„ä»¶å†…éƒ¨è¢«å¤„ç† -->
```

```vue
<!-- MyComponent -->
<button @click="$emit('someEvent')">Click Me</button> <!-- äº‹ä»¶å°†ä¼ é€’ç»™çˆ¶ç»„ä»¶ -->
```

```vue
<!-- MyComponent -->
<button @click="$emit('someEvent', 1, 2, 3)">Click Me</button> <!-- ä¼ é€’å‚æ•° -->
```
````

åœ¨`setup`å‡½æ•°ä¸­å£°æ˜äº‹ä»¶ï¼š

````md magic-move
```js{all|2|3,5|all}
export default {
  emits: ['inFocus', 'submit'],
  setup(props, ctx) {
    ctx.emit('submit')
  }
}
```

```js
export default {
  emits: ['inFocus', 'submit'],
  setup(props, { emit }) {
    emit('submit')
  }
}
```
````

åœ¨`<script setup>`ä¸­å£°æ˜äº‹ä»¶ï¼š

````md magic-move
```vue
<script setup>
defineEmits(['inFocus', 'submit'])
</script>
```

```vue
<script setup>
const emit = defineEmits(['inFocus', 'submit'])

const buttonClick = () => { emit('submit') }
</script>
```

```ts
// TypeScript & Vue3.3+
const emit = defineEmits<{
  inFocus: [id: number]
  submit: [value: string]
}>()
```

````



</v-clicks>

---

# Node.jsä¸­çš„å›è°ƒ

## `fs`æ¨¡å—

```js{none|1|2-5|6-18|all}
const fs = require("fs"); // "fs"æ¨¡å—æœ‰æ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„API
let options = {
  // ä¿å­˜ç¨‹åºé€‰é¡¹çš„å¯¹è±¡
  // é»˜è®¤é€‰é¡¹å¯ä»¥å†™åœ¨è¿™é‡Œ
};

// è¯»å–é…ç½®æ–‡ä»¶ï¼Œç„¶åè°ƒç”¨å›è°ƒå‡½æ•°
fs.readFile("config.json", "utf-8", (err, text) => {
  if (err) {
    // å¦‚æœæœ‰é”™è¯¯ï¼Œæ˜¾ç¤ºä¸€æ¡è­¦å‘Šæ¶ˆæ¯ï¼Œä½†ä»ç„¶ç»§ç»­
    console.warn("Could not read config file:", err);
  } else {
    // å¦åˆ™ï¼Œè§£ææ–‡ä»¶å†…å®¹å¹¶èµ‹å€¼ç»™é€‰é¡¹å¯¹è±¡
    Object.assign(options, JSON.parse(text));
  }

  startProgram(options);
});
```

---

## `https`æ¨¡å—

```js{none|1|3-4|5-22|6-11|13|15-21|all}{lines:true}
const https = require("https");

function getText(url, callback) {
    request = https.get(url);
    request.on("response", response => { // å¤„ç† "response" äº‹ä»¶
        // æ­¤æ—¶æ”¶åˆ°äº†å“åº”å¤´
        let httpStatus = response.statusCode;

        // æ­¤æ—¶å¹¶æ²¡æœ‰æ”¶åˆ° HTTP å“åº”ä½“ï¼Œå› æ­¤è¿˜è¦å†æ³¨å†Œå‡ ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºï¼Œä»¥ä¾¿æ”¶åˆ°å“åº”ä½“æ—¶è¢«è°ƒç”¨
        response.setEncoding("utf-8");  
        let body = "";                  
        
        response.on("data", chunk => { body += chunk; }); // æ¯ä¸ªå“åº”ä½“å—å°±ç»ªæ—¶
        
        response.on("end", () => {   // å“åº”å®Œæˆæ—¶
            if (httpStatus === 200) {  
                callback(null, body);  // æŠŠå“åº”ä½“ä¼ ç»™å›è°ƒ
            } else { 
                callback(httpStatus, null);  // å¦åˆ™ä¼ é€’é”™è¯¯
            }
        });
    });
}
```
<v-click>
æ€è€ƒï¼šè¿™ä¸ªå¤æ‚çš„ä»£ç é‡Œä¸€å…±æœ‰å‡ ä¸ªå›è°ƒğŸ˜‚ï¼Ÿ
</v-click>

---

# æœŸçº¦(`Promise`)

æœŸçº¦æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¡¨ç¤ºå¼‚æ­¥æ“ä½œçš„ç»“æœã€‚

<v-clicks>

æœŸçº¦æœ‰ä¸€ä¸ªæœ€é‡è¦çš„ä¼˜ç‚¹ï¼Œå°±æ˜¯<span v-mark.blue="+1">ä»¥çº¿æ€§`then`æ–¹æ³•</span>è°ƒç”¨é“¾çš„å½¢å¼è¡¨è¾¾ä¸€ç³»åˆ—å¼‚æ­¥çš„æ“ä½œï¼Œè€Œä¸ç”¨æŠŠæ¯ä¸ªæ“ä½œåµŒå¥—åœ¨å‰ä¸€ä¸ªæ“ä½œçš„å›è°ƒå†…éƒ¨ã€‚

## ä½¿ç”¨Fetch API

```js
fetch("/api/user/profile").then(response => {  // response: Response
  response.json().then(profile => {  // profile: JSON object
    data.value = profile; // åœ¨Vue3çš„onMountedé’©å­é‡Œæ›´æ–°æ•°æ®
  })
})
```

````md magic-move

```js
fetch("/api/user/profile")
 .then(response => {
    return response.json();
 })
 .then(profile => {
    data.value = profile;
  })
```

```js
fetch(url)
 .then(callback1)
 .then(callback2)
```

```js
fetch(url)
 .then(callback1, onError1)
 .then(callback2, onError2)
```


```js
fetch(url)
 .then(callback1, onError1)
 .then(callback2, onError2)
 .then(callback3)
 .catch(error => { console.error(error); }) // ç”¨äºå¤„ç†Promiseé“¾ä¸­çš„é”™è¯¯
 .finally(() => { console.log("done"); }); // ç”¨äºæ”¶å°¾å·¥ä½œï¼Œæ— è®ºé”™è¯¯ä¸å¦å‡ä¼šè§¦å‘
```
````

</v-clicks>

---

## ä½¿ç”¨Axios API

```js
axios.get("/api/user/profile").then(response => {  // response: AxiosResponse
  data.value = response.data; // åœ¨Vue3çš„onMountedé’©å­é‡Œæ›´æ–°æ•°æ®
})
```

<div class="flex gap-4">
<Tag name="å…¨çƒæ–°å† ç–«æƒ…æ•°æ®ç»Ÿè®¡" :difficulty="3" :year="2023" :id="5137" />
<Tag name="è¯¾ç¨‹åˆ—è¡¨" :difficulty="3" :year="2022" :id="2457" />
</div>

---

# ğŸ‰ `JS Doc`ï¼ 

VS Codeåœ¨ä¸å®‰è£…æ’ä»¶çš„æƒ…å†µä¸‹ï¼ŒåŸç”Ÿå¯¹JS Docæä¾›æ”¯æŒã€‚

è¿™æ„å‘³ç€å¯¹äºå¾ˆå¤šåç«¯å¼€å‘è€…ï¼Œæˆ–è€…ä¹ æƒ¯TypeScriptçš„å‰ç«¯å¼€å‘è€…æ¥è¯´ï¼ŒJavaScriptä¸å†ç¼ºå°‘ç±»å‹ä¿¡æ¯ã€‚

<v-clicks>

![js-doc](/js-doc.png) {.w-1/2 .mx-auto .border .border-red-300}

</v-clicks>

---

# `async`å’Œ`await`

<v-clicks>

å…è®¸æˆ‘ä»¬ä»¥åŒæ­¥çš„æ–¹å¼ç¼–å†™å¼‚æ­¥çš„ä»£ç ã€‚

æˆ‘ä»¬å‘ç°ï¼ŒåŸºäºçº¿æ€§`then`çš„å¼‚æ­¥ä»£ç ä¸èƒ½åƒæ­£å¸¸çš„åŒæ­¥ä»£ç ä¸€æ ·**è¿”å›ä¸€ä¸ªå€¼**æˆ–æ˜¯**æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸**ã€‚

`await`å…³é”®å­—æ¥æ”¶ä¸€ä¸ªæœŸçº¦ï¼Œå°†å…¶è½¬æ¢æˆä¸€ä¸ªè¿”å›å€¼æˆ–ä¸€ä¸ªæŠ›å‡ºçš„å¼‚å¸¸ã€‚

<div class="w-full justify-center flex gap-20">

  <div class="flex-1">

  ```js
  fetch("/api/user/profile")
  .then(response => {
      return response.json();
  })
  .then(profile => {
      data.value = profile;
    })
  ```

  </div>

  <div class="flex-1">

  ```js
  let response = await fetch("/api/user/profile");
  let profile = await response.json();
  data.value = profile;
  ```

  </div>

</div>

ğŸ“¢ æ³¨æ„ï¼šåªèƒ½åœ¨`async`å®šä¹‰çš„å‡½æ•°ä¸­ä½¿ç”¨`await`å…³é”®å­—ã€‚

æŠŠå‡½æ•°æ ‡æ³¨ä¸º`async`æ„å‘³ç€å®ƒ**è¿”å›ä¸€ä¸ªæœŸçº¦**ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿”å›ä¸€ä¸ªå€¼ã€‚

</v-clicks>

---

## å¹¶è¡ŒæœŸçº¦

<v-clicks>

```js
async function getJSON(url) {
  let response = await fetch(url);
  let body = await response.json();
  return body;
}

let value1 = await getJSON("/api/user/profile");
let value2 = await getJSON("/api/user/friends");
```


ä»¥ä¸Šä»£ç çš„é—®é¢˜åœ¨äºå®ƒæœ¬ä¸å¿…é¡ºåºæ‰§è¡Œã€‚è¦ç­‰å€™ä¸€ç»„å¹¶å‘æ‰§è¡Œçš„`async`å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨`Promise.all()`æ–¹æ³•ã€‚

```js
let [value1, value2] = await Promise.all([
  getJSON("/api/user/profile"),
  getJSON("/api/user/friends")
]);
```

</v-clicks>

---

## ç»ƒä¹ ï¼šä¸²è¡ŒæœŸçº¦

æœ‰è¿™æ ·ä¸€ç»„æœªçŸ¥æ•°é‡çš„`url`æ•°ç»„ï¼Œä¸ºäº†é¿å…ç½‘ç»œè¿‡è½½ï¼Œä½ ä¸€æ¬¡åªèƒ½æŠ“å–ä¸€ä¸ª`url`ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥æ„é€ è¿™æ ·çš„æœŸçº¦ã€‚

````md magic-move
```js
function fetchAll(urls) {
  const results = [];
  function fetchOne(url) {
    // TODO
  }
  // TODO
}
```

```js{all|3-5|3-8|all}
function fetchAll(urls) {
  const results = [];
  function fetchOne(url) {
    return fetch(url).then(response => response.json());
  }
  urls.forEach(url => {
    results.push(fetchOne(url));
  })
  return Promise.all(results);
}
```

```js{all|3-9|10|10-13|10-14|all}
function fetchAll(urls) {
  const results = [];
  function fetchOne(url) {
    return fetch(url)
              .then(response => response.json())
              .then(result => {
                results.push(result);
              })
  }
  let p = Promise.resolve(); // ç«‹å³å…‘ç°çš„æœŸçº¦
  urls.forEach(url => {
    p = p.then(() => fetchOne(url));
  })
  return p.then(() => results);
}
```
````



---

## ç»ƒä¹ ï¼š`async/await`çš„å®ç°åŸç†

<v-click>

````md magic-move
```js
async function f(x) { /* body */ }
```

```js
function f(x) {
  return new Promise((resolve, reject) => {
    try {
      resolve(function(x) { /* body */ }(x));
    }
    catch (e) {
      reject(e);
    }
  })
}
```

````

</v-click>
